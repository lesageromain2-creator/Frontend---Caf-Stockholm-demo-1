datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ============================================
// MODELS
// ============================================

model User {
  id                      String                   @id @default(uuid()) @db.Uuid
  email                   String                   @unique @db.VarChar(255)
  passwordHash            String                   @map("password_hash") @db.VarChar(255)
  firstname               String                   @db.VarChar(100)
  lastname                String                   @db.VarChar(100)
  companyName             String?                  @map("company_name") @db.VarChar(200)
  phone                   String?                  @db.VarChar(20)
  role                    String                   @default("client") @db.VarChar(20)
  avatarUrl               String?                  @map("avatar_url") @db.Text
  isActive                Boolean                  @default(true) @map("is_active")
  emailVerified           Boolean                  @default(false) @map("email_verified")
  createdAt               DateTime                 @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime                 @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  lastLogin               DateTime?                @map("last_login") @db.Timestamptz(6)

  // Relations
  clientProjects          ClientProject[]
  assignedProjects         ClientProject[]          @relation("AssignedProjects")
  projectTasks             ProjectTask[]            @relation("AssignedTasks")
  projectFiles             ProjectFile[]
  projectUpdates           ProjectUpdate[]
  projectComments          ProjectComment[]
  projectMilestonesCreated ProjectMilestone[]      @relation("CreatedMilestones")
  projectMilestonesUpdated ProjectMilestone[]      @relation("UpdatedMilestones")
  reservations             Reservation[]
  reservationsConfirmed    Reservation[]            @relation("ConfirmedReservations")
  contactMessages          ContactMessage[]         @relation("AssignedMessages")
  emailLogs                EmailLog[]
  emailPreferences         EmailPreferences?
  testimonials             Testimonial[]
  userNotifications        UserNotification[]
  adminActivityLogs        AdminActivityLog[]
  adminAlertsResolved      AdminAlert[]             @relation("ResolvedAlerts")
  blogPosts                BlogPost[]
  emailTemplatesCreated   EmailTemplate[]          @relation("CreatedTemplates")
  emailTemplatesUpdated   EmailTemplate[]          @relation("UpdatedTemplates")
  contactRepliedMessages   ContactMessage[]        @relation("RepliedMessages")
  contactMessageReplies    ContactMessageReply[]
  messageTemplates        MessageTemplate[]

  @@map("users")
}

model ClientProject {
  id                 String              @id @default(uuid()) @db.Uuid
  userId             String              @map("user_id") @db.Uuid
  title              String              @db.VarChar(200)
  description        String?             @db.Text
  projectType        String              @map("project_type") @db.VarChar(50)
  status             String              @default("discovery") @db.VarChar(30)
  progress           Int                 @default(0)
  startDate          DateTime?           @map("start_date") @db.Date
  estimatedDelivery  DateTime?           @map("estimated_delivery") @db.Date
  deliveredAt        DateTime?           @map("delivered_at") @db.Timestamptz(6)
  totalPrice         Decimal?            @map("total_price") @db.Decimal(10, 2)
  depositPaid        Boolean             @default(false) @map("deposit_paid")
  depositAmount      Decimal?            @map("deposit_amount") @db.Decimal(10, 2)
  finalPaid          Boolean             @default(false) @map("final_paid")
  stagingUrl         String?             @map("staging_url") @db.Text
  productionUrl      String?             @map("production_url") @db.Text
  priority           String              @default("medium") @db.VarChar(20)
  assignedTo         String?             @map("assigned_to") @db.Uuid
  createdAt          DateTime            @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime            @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  assignedUser       User?               @relation("AssignedProjects", fields: [assignedTo], references: [id], onDelete: SetNull)
  tasks              ProjectTask[]
  files              ProjectFile[]
  updates            ProjectUpdate[]
  comments           ProjectComment[]
  milestones         ProjectMilestone[]

  @@map("client_projects")
}

model ProjectTask {
  id           String    @id @default(uuid()) @db.Uuid
  projectId    String    @map("project_id") @db.Uuid
  assignedTo   String?   @map("assigned_to") @db.Uuid
  title        String    @db.VarChar(255)
  description  String?   @db.Text
  status       String    @default("todo") @db.VarChar(30)
  priority     String    @default("medium") @db.VarChar(20)
  dueDate      DateTime? @map("due_date") @db.Date
  completedAt  DateTime? @map("completed_at") @db.Timestamptz(6)
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  project      ClientProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignedUser User?         @relation("AssignedTasks", fields: [assignedTo], references: [id], onDelete: SetNull)

  @@map("project_tasks")
}

model ProjectUpdate {
  id         String        @id @default(uuid()) @db.Uuid
  projectId  String        @map("project_id") @db.Uuid
  createdBy  String?       @map("created_by") @db.Uuid
  title      String        @db.VarChar(255)
  message    String        @db.Text
  updateType String        @default("info") @map("update_type") @db.VarChar(50)
  isRead     Boolean       @default(false) @map("is_read")
  createdAt  DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  project    ClientProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  creator    User?         @relation(fields: [createdBy], references: [id], onDelete: SetNull)

  @@map("project_updates")
}

model ProjectComment {
  id              String           @id @default(uuid()) @db.Uuid
  projectId       String           @map("project_id") @db.Uuid
  authorId        String           @map("author_id") @db.Uuid
  parentCommentId String?          @map("parent_comment_id") @db.Uuid
  comment         String           @db.Text
  isInternal      Boolean          @default(false) @map("is_internal")
  createdAt       DateTime         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  project         ClientProject    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  author          User             @relation(fields: [authorId], references: [id], onDelete: Cascade)
  parentComment   ProjectComment?  @relation("CommentReplies", fields: [parentCommentId], references: [id], onDelete: Cascade)
  replies         ProjectComment[] @relation("CommentReplies")

  @@map("project_comments")
}

model ProjectFile {
  id          String        @id @default(uuid()) @db.Uuid
  projectId   String        @map("project_id") @db.Uuid
  userId      String        @map("user_id") @db.Uuid
  fileName    String        @map("file_name") @db.VarChar(255)
  fileUrl     String        @map("file_url") @db.Text
  fileType    String?       @map("file_type") @db.VarChar(100)
  fileSize    Int?          @map("file_size")
  description String?       @db.Text
  createdAt   DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  project     ClientProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("project_files")
}

model Reservation {
  id                  String    @id @default(uuid()) @db.Uuid
  userId              String    @map("user_id") @db.Uuid
  reservationDate     DateTime  @map("reservation_date") @db.Date
  reservationTime     DateTime  @map("reservation_time") @db.Time(6)
  duration            Int       @default(60)
  meetingType         String    @default("visio") @map("meeting_type") @db.VarChar(20)
  projectType         String?   @map("project_type") @db.VarChar(50)
  estimatedBudget     String?   @map("estimated_budget") @db.VarChar(50)
  message             String?   @db.Text
  status              String    @default("pending") @db.VarChar(20)
  confirmedBy         String?   @map("confirmed_by") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  cancelledAt         DateTime? @map("cancelled_at") @db.Timestamptz(6)
  cancellationReason  String?   @map("cancellation_reason") @db.Text

  // Relations
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  confirmedByUser     User?     @relation("ConfirmedReservations", fields: [confirmedBy], references: [id], onDelete: SetNull)

  @@map("reservations")
}

model ContactMessage {
  id           String                  @id @default(uuid()) @db.Uuid
  name         String                  @db.VarChar(150)
  email        String                  @db.VarChar(255)
  phone        String?                 @db.VarChar(20)
  company      String?                 @db.VarChar(200)
  subject      String?                 @db.VarChar(255)
  projectType  String?                 @map("project_type") @db.VarChar(50)
  budgetRange  String?                 @map("budget_range") @db.VarChar(50)
  message      String                  @db.Text
  ipAddress    String?                 @map("ip_address") @db.Inet
  userAgent    String?                 @map("user_agent") @db.Text
  isRead       Boolean                 @default(false) @map("is_read")
  status       String                  @default("new") @db.VarChar(20)
  priority     String                  @default("normal") @db.VarChar(20)
  assignedTo   String?                 @map("assigned_to") @db.Uuid
  repliedBy    String?                 @map("replied_by") @db.Uuid
  repliedAt    DateTime?               @map("replied_at") @db.Timestamptz(6)
  createdAt    DateTime                @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  assignedUser User?                   @relation("AssignedMessages", fields: [assignedTo], references: [id], onDelete: SetNull)
  repliedUser  User?                   @relation("RepliedMessages", fields: [repliedBy], references: [id], onDelete: SetNull)
  replies      ContactMessageReply[]

  @@map("contact_messages")
}

model ContactMessageReply {
  id            String         @id @default(uuid()) @db.Uuid
  messageId     String         @map("message_id") @db.Uuid
  adminId       String         @map("admin_id") @db.Uuid
  replyText     String         @map("reply_text") @db.Text
  sentViaEmail  Boolean        @default(true) @map("sent_via_email")
  createdAt     DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  message       ContactMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  admin         User           @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@map("contact_message_replies")
}

model EmailLog {
  id                 String    @id @default(uuid()) @db.Uuid
  recipientEmail     String    @map("recipient_email") @db.VarChar(255)
  recipientName      String?   @map("recipient_name") @db.VarChar(255)
  userId             String?   @map("user_id") @db.Uuid
  emailType          String    @map("email_type") @db.VarChar(100)
  subject            String    @db.VarChar(500)
  templateName       String?   @map("template_name") @db.VarChar(100)
  context            Json?
  variables          Json?
  status             String    @default("pending") @db.VarChar(30)
  errorMessage       String?   @map("error_message") @db.Text
  provider           String    @default("nodemailer") @db.VarChar(50)
  providerMessageId  String?   @map("provider_message_id") @db.VarChar(255)
  sentAt             DateTime? @map("sent_at") @db.Timestamptz(6)
  deliveredAt        DateTime? @map("delivered_at") @db.Timestamptz(6)
  openedAt           DateTime? @map("opened_at") @db.Timestamptz(6)
  clickedAt          DateTime? @map("clicked_at") @db.Timestamptz(6)
  bouncedAt          DateTime? @map("bounced_at") @db.Timestamptz(6)
  createdAt          DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  user               User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("email_logs")
}

model EmailTemplate {
  id                  String    @id @default(uuid()) @db.Uuid
  templateKey         String    @unique @map("template_key") @db.VarChar(100)
  name                String    @db.VarChar(255)
  description         String?   @db.Text
  subject             String    @db.VarChar(500)
  htmlBody            String    @map("html_body") @db.Text
  textBody            String?   @map("text_body") @db.Text
  availableVariables  Json?     @map("available_variables")
  category            String    @default("general") @db.VarChar(50)
  isActive            Boolean   @default(true) @map("is_active")
  version             Int       @default(1)
  lastUsedAt          DateTime? @map("last_used_at") @db.Timestamptz(6)
  usageCount          Int       @default(0) @map("usage_count")
  createdBy           String?   @map("created_by") @db.Uuid
  updatedBy           String?   @map("updated_by") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  creator             User?     @relation("CreatedTemplates", fields: [createdBy], references: [id], onDelete: SetNull)
  updater             User?     @relation("UpdatedTemplates", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@map("email_templates")
}

model EmailPreferences {
  id                        String   @id @default(uuid()) @db.Uuid
  userId                    String   @unique @map("user_id") @db.Uuid
  emailNotifications        Boolean  @default(true) @map("email_notifications")
  marketingEmails            Boolean  @default(true) @map("marketing_emails")
  reservationConfirmations   Boolean  @default(true) @map("reservation_confirmations")
  reservationReminders      Boolean  @default(true) @map("reservation_reminders")
  projectUpdates             Boolean  @default(true) @map("project_updates")
  projectStatusChanges      Boolean  @default(true) @map("project_status_changes")
  paymentNotifications       Boolean  @default(true) @map("payment_notifications")
  newsletter                 Boolean  @default(true)
  digestFrequency           String   @default("immediate") @map("digest_frequency") @db.VarChar(20)
  createdAt                  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                  DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  user                      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("email_preferences")
}

model PortfolioProject {
  id                  String             @id @default(uuid()) @db.Uuid
  title               String             @db.VarChar(200)
  slug                String             @unique @db.VarChar(250)
  description         String?            @db.Text
  clientName          String?            @map("client_name") @db.VarChar(150)
  category            String             @db.VarChar(50)
  thumbnailUrl         String            @map("thumbnail_url") @db.Text
  imagesUrls          String[]           @map("images_urls")
  videoUrl            String?            @map("video_url") @db.Text
  technologies        String[]
  liveUrl             String?            @map("live_url") @db.Text
  githubUrl           String?            @map("github_url") @db.Text
  featured            Boolean            @default(false)
  completionDate      DateTime?          @map("completion_date") @db.Date
  displayOrder        Int                @default(0) @map("display_order")
  isPublished         Boolean            @default(true) @map("is_published")
  testimonial         String?            @db.Text
  testimonialAuthor   String?            @map("testimonial_author") @db.VarChar(100)
  testimonialCompany  String?            @map("testimonial_company") @db.VarChar(150)
  createdAt           DateTime           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  testimonials        Testimonial[]
  portfolioImages     PortfolioImage[]

  @@map("portfolio_projects")
}

model PortfolioImage {
  id                   String            @id @default(uuid()) @db.Uuid
  portfolioProjectId   String            @map("portfolio_project_id") @db.Uuid
  cloudinaryPublicId   String            @map("cloudinary_public_id") @db.VarChar(255)
  imageUrl             String            @map("image_url") @db.Text
  thumbnailUrl         String            @map("thumbnail_url") @db.Text
  mediumUrl            String?           @map("medium_url") @db.Text
  displayOrder         Int              @default(0) @map("display_order")
  altText              String?           @map("alt_text") @db.VarChar(255)
  caption              String?           @db.Text
  width                Int?
  height               Int?
  isFeatured           Boolean          @default(false) @map("is_featured")
  createdAt            DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  portfolioProject     PortfolioProject  @relation(fields: [portfolioProjectId], references: [id], onDelete: Cascade)

  @@map("portfolio_images")
}

model BlogPost {
  id               String    @id @default(uuid()) @db.Uuid
  authorId         String?   @map("author_id") @db.Uuid
  title            String    @db.VarChar(255)
  slug             String    @unique @db.VarChar(300)
  excerpt          String?   @db.Text
  content          String    @db.Text
  metaDescription  String?   @map("meta_description") @db.VarChar(500)
  metaKeywords     String[]  @map("meta_keywords")
  featuredImageUrl String?   @map("featured_image_url") @db.Text
  category         String?   @db.VarChar(50)
  tags             String[]
  status           String    @default("draft") @db.VarChar(20)
  isFeatured        Boolean   @default(false) @map("is_featured")
  viewsCount        Int       @default(0) @map("views_count")
  publishedAt       DateTime? @map("published_at") @db.Timestamptz(6)
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  author           User?     @relation(fields: [authorId], references: [id], onDelete: SetNull)

  @@map("blog_posts")
}

model Offer {
  id                String    @id @default(uuid()) @db.Uuid
  name              String    @db.VarChar(255)
  slug              String    @unique @db.VarChar(300)
  description       String    @db.Text
  shortDescription String?   @map("short_description") @db.VarChar(500)
  priceFrom         Decimal?  @map("price_from") @db.Decimal(10, 2)
  priceTo           Decimal?  @map("price_to") @db.Decimal(10, 2)
  priceType         String    @default("range") @map("price_type") @db.VarChar(20)
  priceStartingAt   Decimal?  @map("price_starting_at") @db.Decimal(10, 2)
  currency          String    @default("EUR") @db.VarChar(3)
  durationWeeks     Int?      @map("duration_weeks")
  category          String?   @db.VarChar(50)
  features          String[]
  deliverables      String[]
  timelineMin       Int?      @map("timeline_min")
  timelineMax       Int?      @map("timeline_max")
  icon              String?   @db.VarChar(50)
  imageUrl          String?   @map("image_url") @db.Text
  colorTheme        String?   @map("color_theme") @db.VarChar(50)
  displayOrder      Int       @default(0) @map("display_order")
  isActive          Boolean   @default(true) @map("is_active")
  isFeatured        Boolean   @default(false) @map("is_featured")
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@map("offers")
}

model Testimonial {
  id                 String             @id @default(uuid()) @db.Uuid
  userId             String?            @map("user_id") @db.Uuid
  projectId          String?            @map("project_id") @db.Uuid
  authorName         String             @map("author_name") @db.VarChar(150)
  authorRole         String?            @map("author_role") @db.VarChar(150)
  authorCompany      String?            @map("author_company") @db.VarChar(200)
  authorAvatarUrl    String?            @map("author_avatar_url") @db.Text
  content            String             @db.Text
  rating             Int?
  isFeatured         Boolean            @default(false) @map("is_featured")
  isApproved         Boolean            @default(false) @map("is_approved")
  displayOrder       Int                @default(0) @map("display_order")
  createdAt          DateTime           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  user               User?              @relation(fields: [userId], references: [id], onDelete: SetNull)
  portfolioProject   PortfolioProject?  @relation(fields: [projectId], references: [id], onDelete: SetNull)

  @@map("testimonials")
}

model UserNotification {
  id          String    @id @default(uuid()) @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  title       String    @db.VarChar(255)
  message     String    @db.Text
  type        String    @default("info") @db.VarChar(50)
  relatedType String?   @map("related_type") @db.VarChar(50)
  relatedId   String?   @map("related_id") @db.Uuid
  isRead      Boolean   @default(false) @map("is_read")
  readAt      DateTime? @map("read_at") @db.Timestamptz(6)
  actionUrl   String?   @map("action_url") @db.Text
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_notifications")
}

model AdminActivityLog {
  id            String    @id @default(uuid()) @db.Uuid
  adminUserId   String    @map("admin_user_id") @db.Uuid
  action        String    @db.VarChar(100)
  resourceType  String?   @map("resource_type") @db.VarChar(50)
  resourceId    String?   @map("resource_id") @db.Uuid
  details       Json?
  ipAddress     String?   @map("ip_address") @db.Inet
  userAgent     String?   @map("user_agent") @db.Text
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  adminUser     User      @relation(fields: [adminUserId], references: [id], onDelete: Cascade)

  @@map("admin_activity_logs")
}

model AdminAlert {
  id                    String    @id @default(uuid()) @db.Uuid
  alertType             String    @map("alert_type") @db.VarChar(50)
  title                 String    @db.VarChar(255)
  message               String?   @db.Text
  severity              String    @default("info") @db.VarChar(20)
  isResolved            Boolean   @default(false) @map("is_resolved")
  relatedResourceType   String?   @map("related_resource_type") @db.VarChar(50)
  relatedResourceId     String?   @map("related_resource_id") @db.Uuid
  resolvedAt            DateTime? @map("resolved_at") @db.Timestamptz(6)
  resolvedBy            String?   @map("resolved_by") @db.Uuid
  expiresAt             DateTime? @map("expires_at") @db.Timestamptz(6)
  createdAt             DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  resolver              User?     @relation("ResolvedAlerts", fields: [resolvedBy], references: [id], onDelete: SetNull)

  @@map("admin_alerts")
}

model NewsletterSubscriber {
  id                  String    @id @default(uuid()) @db.Uuid
  email               String    @unique @db.VarChar(255)
  firstname           String?   @db.VarChar(100)
  lastname            String?   @db.VarChar(100)
  status              String    @default("active") @db.VarChar(20)
  subscriptionSource  String?   @map("subscription_source") @db.VarChar(50)
  ipAddress           String?   @map("ip_address") @db.Inet
  userAgent           String?   @map("user_agent") @db.Text
  subscribedAt        DateTime  @default(now()) @map("subscribed_at") @db.Timestamptz(6)
  unsubscribedAt      DateTime? @map("unsubscribed_at") @db.Timestamptz(6)
  lastEmailSentAt     DateTime? @map("last_email_sent_at") @db.Timestamptz(6)
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  @@map("newsletter_subscribers")
}

model Setting {
  id           String   @id @default(uuid()) @db.Uuid
  settingKey   String   @unique @map("setting_key") @db.VarChar(100)
  settingValue String?  @map("setting_value") @db.Text
  settingType  String   @default("text") @map("setting_type") @db.VarChar(20)
  description  String?  @db.Text
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@map("settings")
}

model EmailVerificationToken {
  id        String    @id @default(uuid()) @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  token     String    @unique @db.VarChar(255)
  expiresAt DateTime @map("expires_at") @db.Timestamptz(6)
  usedAt    DateTime? @map("used_at") @db.Timestamptz(6)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@map("email_verification_tokens")
}

model PasswordResetToken {
  id        String    @id @default(uuid()) @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  token     String    @unique @db.VarChar(255)
  expiresAt DateTime  @map("expires_at") @db.Timestamptz(6)
  used      Boolean   @default(false)
  usedAt    DateTime? @map("used_at") @db.Timestamptz(6)
  ipAddress String?   @map("ip_address") @db.Inet
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  @@map("password_reset_tokens")
}

model LoginAttempt {
  id             String    @id @default(uuid()) @db.Uuid
  email          String    @db.VarChar(255)
  ipAddress      String    @map("ip_address") @db.Inet
  userAgent      String?   @map("user_agent") @db.Text
  success        Boolean   @default(false)
  failureReason  String?   @map("failure_reason") @db.VarChar(100)
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  @@map("login_attempts")
}

model ProjectMilestone {
  id                   String         @id @default(uuid()) @db.Uuid
  projectId            String         @map("project_id") @db.Uuid
  title                String         @db.VarChar(255)
  description          String?        @db.Text
  sequence             Int            @default(0)
  dueDate              DateTime?      @map("due_date") @db.Date
  completedAt          DateTime?      @map("completed_at") @db.Timestamptz(6)
  status               String         @default("pending") @db.VarChar(30)
  progress             Int            @default(0)
  isVisibleToClient    Boolean        @default(true) @map("is_visible_to_client")
  createdBy            String?        @map("created_by") @db.Uuid
  updatedBy            String?        @map("updated_by") @db.Uuid
  createdAt            DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  project              ClientProject  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  creator              User?          @relation("CreatedMilestones", fields: [createdBy], references: [id], onDelete: SetNull)
  updater              User?          @relation("UpdatedMilestones", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@map("project_milestones")
}

model MessageTemplate {
  id        String    @id @default(uuid()) @db.Uuid
  name      String    @unique @db.VarChar(255)
  subject   String    @db.VarChar(255)
  body      String    @db.Text
  category  String?   @db.VarChar(50)
  createdBy String?   @map("created_by") @db.Uuid
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  creator   User?     @relation(fields: [createdBy], references: [id], onDelete: SetNull)

  @@map("message_templates")
}

// ============================================
// BETTER AUTH MODELS
// ============================================

model BetterAuthUser {
  id              String   @id @db.Text
  name            String?  @db.Text
  email           String   @unique @db.Text
  emailVerified   Boolean  @default(false) @map("emailVerified")
  image           String?  @db.Text
  createdAt       DateTime @default(now()) @map("createdAt") @db.Timestamptz(6)
  updatedAt       DateTime @default(now()) @updatedAt @map("updatedAt") @db.Timestamptz(6)
  twoFactorEnabled Boolean? @default(false) @map("twoFactorEnabled")

  sessions   BetterAuthSession[]
  accounts   BetterAuthAccount[]
  twoFactors BetterAuthTwoFactor[]

  @@map("better_auth_user")
}

model BetterAuthSession {
  id        String   @id @db.Text
  userId    String   @map("userId") @db.Text
  token     String   @unique @db.Text
  expiresAt DateTime @map("expiresAt") @db.Timestamptz(6)
  ipAddress String?  @map("ipAddress") @db.Text
  userAgent String?  @map("userAgent") @db.Text
  createdAt DateTime @default(now()) @map("createdAt") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updatedAt") @db.Timestamptz(6)

  user BetterAuthUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("better_auth_session")
}

model BetterAuthAccount {
  id           String    @id @db.Text
  userId       String    @map("userId") @db.Text
  accountId    String    @map("accountId") @db.Text
  providerId   String    @map("providerId") @db.Text
  accessToken  String?   @map("accessToken") @db.Text
  refreshToken String?   @map("refreshToken") @db.Text
  idToken      String?   @map("idToken") @db.Text
  expiresAt    DateTime? @map("expiresAt") @db.Timestamptz(6)
  scope        String?   @db.Text
  password     String?   @db.Text
  createdAt    DateTime  @default(now()) @map("createdAt") @db.Timestamptz(6)
  updatedAt    DateTime  @default(now()) @updatedAt @map("updatedAt") @db.Timestamptz(6)

  user BetterAuthUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("better_auth_account")
}

model BetterAuthVerification {
  id         String   @id @db.Text
  identifier String   @db.Text
  value      String   @db.Text
  expiresAt  DateTime @map("expiresAt") @db.Timestamptz(6)
  createdAt  DateTime @default(now()) @map("createdAt") @db.Timestamptz(6)
  updatedAt  DateTime @default(now()) @updatedAt @map("updatedAt") @db.Timestamptz(6)

  @@map("better_auth_verification")
}

model BetterAuthTwoFactor {
  id          String @id @db.Text
  userId      String @map("userId") @db.Text
  secret      String @db.Text
  backupCodes String @map("backupCodes") @db.Text

  user BetterAuthUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("better_auth_two_factor")
}
